import{a as ee}from"./chunk-XZOPVRI2.js";import{a as X,b as Y,c as Z}from"./chunk-OSCE4TAW.js";import{a as W}from"./chunk-XB6PQKIB.js";import{B as K,c as G,e as d,h as R,i as q,j,l as m,n as L,o as V,q as $,r as z,s as U,t as H,u as J}from"./chunk-MZMOS6PQ.js";import{a as Q}from"./chunk-KL2CPU5E.js";import"./chunk-4YLOEDTQ.js";import"./chunk-NMJRHXIR.js";import{c as M}from"./chunk-YMOXGVMI.js";import{Ec as B,Ib as P,Ka as I,Kb as _,Pa as a,Uc as A,Wb as p,Wc as O,Ya as v,Yb as n,Zb as f,a as C,b as g,cb as T,hb as N,nc as b,oc as k,pb as S,qb as D,rb as x,tb as F,ub as E,vb as u,wb as o,xb as i,yb as s}from"./chunk-Z7HY6CCI.js";function ie(l,t){if(l&1&&(o(0,"option",24),n(1),i()),l&2){let e=t.$implicit;u("value",e.name),a(),f(e.name)}}function oe(l,t){if(l&1&&(o(0,"div",40)(1,"figure"),s(2,"img",41),i(),o(3,"div",42)(4,"h5",43),n(5),i(),o(6,"p",44),n(7),b(8,"currency"),i()()()),l&2){let e=_().$implicit;a(2),u("src",e.tour.featured_image,I)("alt",e.tour.title),a(3),f(e.tour.title),a(2),f(k(8,4,e.tour.start_from))}}function re(l,t){l&1&&N(0,oe,9,6,"ng-template",39)}function ne(l,t){if(l&1&&(o(0,"owl-carousel-o",30),F(1,re,1,0,null,39,x),i()),l&2){let e=_();u("options",e.cartListOptions),a(),E(e.CartData)}}function ae(l,t){l&1&&(o(0,"p",31),n(1,"No data found in your cart"),i())}function le(l,t){if(l&1&&(o(0,"div",38)(1,"h6",33),n(2,"Total Price After Discount"),i(),o(3,"h6",34),n(4),b(5,"currency"),i()()),l&2){let e=_();a(4),f(k(5,1,e.getTotalPrice()))}}var te=class l{constructor(t,e,r,h){this._BookingService=t;this.toaster=e;this._Router=r;this._cdr=h}backgroundImage="../../../assets/image/banner.webp";checkoutForm;AllCountries=[];checkoutData={};haveData=!1;CartData=[];couponApplied=!1;totalPrice=0;ngOnInit(){this.getCountries(),this.getCartData();let t=/^01{0,1,2,5}{8}$/;this.checkoutForm=new j({first_name:new m("",[d.required]),last_name:new m("",[d.required]),email:new m("",[d.required,d.email]),phone:new m("",[d.required,d.pattern(t)]),state:new m("",[d.required]),country:new m("",[d.required]),notes:new m(""),coupon_id:new m(""),currency_id:new m(1)})}getCheckoutData(){if(console.log(this.checkoutForm.value),console.log(this.checkoutForm.valid),!this.checkoutForm.valid)return;this.checkoutData=C({},this.checkoutForm.value),this.checkoutForm.get("coupon_id")?.value?.trim()&&this.couponApplied?(this.applyCoupon(),this.sendCheckoutData(),this.CartData=[],this.haveData=!1,this._Router.navigate(["/"]),this.toaster.success("Order placed successfully")):(this.checkoutData=g(C({},this.checkoutData),{coupon_id:""}),this.sendCheckoutData(),this.CartData=[],this.haveData=!1,this._Router.navigate(["/"]),this.toaster.success("Order placed successfully"))}applyCoupon(){let t=this.checkoutForm.get("coupon_id")?.value?.trim();t&&t!==""?this._BookingService.getCoupon(t).subscribe({next:e=>{this.toaster.success(e.message),setTimeout(()=>{e.data?.id&&(this.checkoutData=g(C({},this.checkoutData),{coupon_id:e.data.id}),this.couponApplied=!0,this.checkoutForm.get("coupon_id")?.reset()),this._cdr.markForCheck()},0)},error:e=>{this.toaster.error(e.error?.message||"Invalid coupon code"),setTimeout(()=>{this.couponApplied=!1,this.checkoutForm.get("coupon_id")?.reset(),this._cdr.markForCheck()},0)}}):(this.toaster.error("Please enter a coupon code"),setTimeout(()=>{this.couponApplied=!1,this._cdr.markForCheck()},0))}sendCheckoutData(){this._BookingService.sendCheckoutData(this.checkoutData).subscribe({next:t=>{this.toaster.success(t.message),this.checkoutForm.reset()},error:t=>{this.toaster.error(t.error?.message||"Error submitting checkout")}})}getCartData(){this._BookingService.getCartList().subscribe({next:t=>{setTimeout(()=>{this.CartData=t.data,this.CartData.length>0?(this.haveData=!0,this.CartData=this.CartData.map(e=>g(C({},e),{total_Price:e.total_price||this.calculateCartItemPrice(e)}))):this.haveData=!1,this.totalPrice=this.calculateTotalPrice(),this._cdr.markForCheck(),console.log("CartData",this.CartData)},0)},error:t=>{console.log("Error",t)}})}calculateCartItemPrice(t){if(!t||!t.tour)return 0;let e=t.adults||0,r=t.children||0,h=t.infants||0,c=t.tour;if(c.pricing_groups&&c.pricing_groups.length>0){let y=c.pricing_groups.find(w=>e>=w.from&&e<=w.to);return y?e*y.price+r*y.child_price+h*(c.infant_price||0):e*c.adult_price+r*c.child_price+h*(c.infant_price||0)}else return e*c.adult_price+r*c.child_price+h*(c.infant_price||0)}calculateTotalPrice(){return!this.CartData||this.CartData.length===0?0:this.CartData.reduce((t,e)=>t+(e.total_Price||0),0)}getTotalPrice(){return this.totalPrice}isFieldInvalid(t){let e=this.checkoutForm.get(t);return!!(e&&e.invalid&&(e.dirty||e.touched))}getCountries(){this._BookingService.getCountries().subscribe({next:t=>{setTimeout(()=>{this.AllCountries=t.data,this._cdr.markForCheck(),console.log("AllCountries",this.AllCountries)},0)},error:t=>{console.log("Error",t)}})}cartListOptions={loop:!0,mouseDrag:!0,touchDrag:!0,pullDrag:!0,dots:!0,smartSpeed:2500,navText:["",""],items:1,autoplay:!0,margin:20,nav:!1};static \u0275fac=function(e){return new(e||l)(v(ee),v(Q),v(M),v(B))};static \u0275cmp=T({type:l,selectors:[["app-checkout"]],decls:66,vars:25,consts:[[3,"title","subtitle","backgroundImage"],[1,"my-5"],[1,"container"],[1,"row","g-3"],[1,"col-lg-8"],[1,"bg-light","p-3","rounded-3","shadow-sm","border"],[1,"text-start"],[1,"h3","fw-bold"],[1,"fontsm"],[1,"row","g-3",3,"ngSubmit","formGroup"],[1,"col-md-6"],["for","first_name",1,"form-label"],["type","text","id","first_name","formControlName","first_name","placeholder","First Name",1,"form-control"],["for","last_name",1,"form-label"],["type","text","id","last_name","formControlName","last_name","placeholder","Last Name",1,"form-control"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","Email",1,"form-control"],["for","phone",1,"form-label"],["type","number","id","phone","formControlName","phone","placeholder","Phone",1,"form-control"],["for","state",1,"form-label"],["type","text","id","state","formControlName","state","placeholder","State",1,"form-control"],["for","country",1,"form-label"],["id","country","formControlName","country",1,"form-control"],["value","","disabled","","selected",""],[3,"value"],[1,"col-12"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Notes","rows","3",1,"form-control"],["type","submit",1,"mainBtn","w-100","mt-3",3,"disabled"],[1,"col-lg-4"],[3,"options"],[1,"text-center","text-danger"],[1,"flexBetween","mt-4"],[1,"mb-1"],[1,"mb-1","textMainColor","fw-bold"],[1,"form-group","flexBetween","gap-3","my-3",3,"formGroup"],["type","text","id","coupon","formControlName","coupon_id","placeholder","Enter coupon code",1,"form-control"],["type","button",1,"btn","secBtn","flex-shrink-0",3,"click"],[1,"flexBetween"],["carouselSlide",""],[1,"card"],[1,"img-fluid",3,"src","alt"],[1,"card-body","pt-0"],[1,"card-title"],[1,"card-text","textMainColor","fw-bold"]],template:function(e,r){e&1&&(s(0,"app-banner",0),o(1,"section",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"h2",7),n(8,"Billing Details"),i(),o(9,"p",8),n(10,"Please fill in the details below to complete your purchase"),i()(),o(11,"form",9),P("ngSubmit",function(){return r.getCheckoutData()}),o(12,"div",10)(13,"label",11),n(14,"First Name"),i(),s(15,"input",12),i(),o(16,"div",10)(17,"label",13),n(18,"Last Name"),i(),s(19,"input",14),i(),o(20,"div",10)(21,"label",15),n(22,"Email"),i(),s(23,"input",16),i(),o(24,"div",10)(25,"label",17),n(26,"Phone"),i(),s(27,"input",18),i(),o(28,"div",10)(29,"label",19),n(30,"state"),i(),s(31,"input",20),i(),o(32,"div",10)(33,"label",21),n(34,"Country"),i(),o(35,"select",22)(36,"option",23),n(37,"Select Country"),i(),F(38,ie,2,2,"option",24,x),i()(),o(40,"div",25)(41,"label",26),n(42,"Notes"),i(),s(43,"textarea",27),i(),o(44,"button",28),n(45,"Submit Order"),i()()()(),o(46,"div",29)(47,"div")(48,"div",6)(49,"h2",7),n(50,"Order Summary"),i(),o(51,"p",8),n(52,"Please review the details below to complete your purchase"),i()(),S(53,ne,3,1,"owl-carousel-o",30)(54,ae,2,0,"p",31),o(55,"div",32)(56,"h6",33),n(57,"Total Price"),i(),o(58,"h6",34),n(59),b(60,"currency"),i()(),o(61,"div",35),s(62,"input",36),o(63,"button",37),P("click",function(){return r.applyCoupon()}),n(64," Apply "),i()(),S(65,le,6,3,"div",38),i()()()()()),e&2&&(u("title","Checkout")("subtitle","Complete your purchase")("backgroundImage",r.backgroundImage),a(11),u("formGroup",r.checkoutForm),a(4),p("is-invalid",r.isFieldInvalid("first_name")),a(4),p("is-invalid",r.isFieldInvalid("last_name")),a(4),p("is-invalid",r.isFieldInvalid("email")),a(4),p("is-invalid",r.isFieldInvalid("phone")),a(4),p("is-invalid",r.isFieldInvalid("state")),a(4),p("is-invalid",r.isFieldInvalid("country")),a(3),E(r.AllCountries),a(5),p("is-invalid",r.isFieldInvalid("notes")),a(),u("disabled",!r.checkoutForm.valid||!r.haveData),a(9),D(r.haveData?53:54),a(6),f(k(60,23,r.getTotalPrice())),a(2),u("formGroup",r.checkoutForm),a(4),D(r.couponApplied?65:-1))},dependencies:[W,O,K,L,H,J,G,V,U,R,q,$,z,Z,Y,X,A],styles:[".checkout-container[_ngcontent-%COMP%]{padding:2rem}.is-invalid[_ngcontent-%COMP%]{border:2px solid #dc3545!important;border-radius:.375rem}.is-invalid[_ngcontent-%COMP%]:focus{border-color:#dc3545!important;box-shadow:0 0 0 .2rem #dc354540!important}"]})};export{te as CheckoutComponent};
